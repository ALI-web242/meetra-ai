openapi: 3.0.3
info:
  title: Meetra AI - Authentication and User Access API
  version: 1.0.0
  description: |
    API for user registration, login, and guest access to Meetra AI.

    ## Authentication
    Protected endpoints require a Bearer token in the Authorization header:
    ```
    Authorization: Bearer <access_token>
    ```

    ## Password Requirements
    - Minimum 8 characters
    - At least one uppercase letter (A-Z)
    - At least one lowercase letter (a-z)
    - At least one number (0-9)
    - At least one special character (@$!%*?&)

servers:
  - url: http://localhost:3000/api/v1
    description: Development server
  - url: https://api.meetra.ai/api/v1
    description: Production server

tags:
  - name: Authentication
    description: User registration and login endpoints
  - name: Guest
    description: Guest access endpoints for meetings

paths:
  /auth/register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Creates a new user account with email and password.
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            examples:
              valid:
                summary: Valid registration request
                value:
                  email: "user@example.com"
                  password: "StrongPassword123!"
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
              example:
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJlbWFpbCI6InVzZXJAZXhhbXBsZS5jb20iLCJ0eXBlIjoidXNlciIsImlhdCI6MTcwMzE1NjgwMCwiZXhwIjoxNzAzMTYwNDAwfQ.xxxxx"
                refreshToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxxxx"
                expiresIn: 3600
                user:
                  id: "550e8400-e29b-41d4-a716-446655440000"
                  email: "user@example.com"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                invalidEmail:
                  summary: Invalid email format
                  value:
                    statusCode: 400
                    message: ["Please provide a valid email address"]
                    error: "Bad Request"
                    timestamp: "2024-12-22T10:30:00.000Z"
                    path: "/api/v1/auth/register"
                weakPassword:
                  summary: Password too weak
                  value:
                    statusCode: 400
                    message: ["Password must be at least 8 characters long", "Password must contain at least one uppercase letter, one lowercase letter, one number, and one special character"]
                    error: "Bad Request"
                    timestamp: "2024-12-22T10:30:00.000Z"
                    path: "/api/v1/auth/register"
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 409
                message: "User with this email already exists"
                error: "Conflict"
                timestamp: "2024-12-22T10:30:00.000Z"
                path: "/api/v1/auth/register"

  /auth/login/email:
    post:
      tags:
        - Authentication
      summary: Login with email and password
      description: Authenticates a user with their email and password credentials.
      operationId: loginWithEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "user@example.com"
              password: "StrongPassword123!"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 401
                message: "Invalid credentials"
                error: "Unauthorized"
                timestamp: "2024-12-22T10:30:00.000Z"
                path: "/api/v1/auth/login/email"

  /auth/login/google:
    get:
      tags:
        - Authentication
      summary: Initiate Google OAuth login flow
      description: |
        Redirects the user to Google's OAuth 2.0 consent screen.
        After successful authentication, user is redirected to `/auth/login/google/callback`.
      operationId: initiateGoogleOAuth
      responses:
        '302':
          description: Redirect to Google's authentication server
          headers:
            Location:
              schema:
                type: string
              description: Google OAuth authorization URL

  /auth/login/google/callback:
    get:
      tags:
        - Authentication
      summary: Google OAuth callback endpoint
      description: |
        Handles the callback from Google OAuth.
        Creates a new user or links to existing account, then redirects to frontend with tokens.
      operationId: googleOAuthCallback
      parameters:
        - name: code
          in: query
          required: true
          schema:
            type: string
          description: Authorization code from Google
        - name: state
          in: query
          schema:
            type: string
          description: State parameter for CSRF protection
      responses:
        '302':
          description: Redirect to frontend with tokens
          headers:
            Location:
              schema:
                type: string
              description: Frontend callback URL
              example: "http://localhost:3001/auth/callback?accessToken=xxx&refreshToken=xxx"
        '401':
          description: Google OAuth failed

  /guest/join:
    post:
      tags:
        - Guest
      summary: Join a meeting as a guest
      description: |
        Allows a user to join a meeting as a guest without requiring an account.
        Creates a temporary guest session that expires in 24 hours.
      operationId: joinAsGuest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GuestJoinRequest'
            examples:
              withInviteCode:
                summary: Join with invite code
                value:
                  meetingId: "550e8400-e29b-41d4-a716-446655440000"
                  inviteCode: "MEETRA-ABC123"
              withoutInviteCode:
                summary: Join without invite code
                value:
                  meetingId: "550e8400-e29b-41d4-a716-446655440000"
      responses:
        '200':
          description: Guest joined successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GuestJoinResponse'
              example:
                guestSessionId: "660e8400-e29b-41d4-a716-446655440001"
                accessToken: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2NjBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDEiLCJ0eXBlIjoiZ3Vlc3QiLCJtZWV0aW5nSWQiOiI1NTBlODQwMC1lMjliLTQxZDQtYTcxNi00NDY2NTU0NDAwMDAiLCJpYXQiOjE3MDMxNTY4MDAsImV4cCI6MTcwMzI0MzIwMH0.xxxxx"
                expiresAt: "2024-12-23T10:30:00.000Z"
        '400':
          description: Invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                statusCode: 400
                message: ["Meeting ID must be a valid UUID"]
                error: "Bad Request"
                timestamp: "2024-12-22T10:30:00.000Z"
                path: "/api/v1/guest/join"
        '404':
          description: Meeting not found

components:
  schemas:
    RegisterRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: "user@example.com"
        password:
          type: string
          format: password
          minLength: 8
          description: User's password (must meet complexity requirements)
          example: "StrongPassword123!"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
          example: "user@example.com"
        password:
          type: string
          format: password
          description: User's password
          example: "StrongPassword123!"

    AuthResponse:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT access token (expires in 1 hour)
        refreshToken:
          type: string
          description: JWT refresh token (expires in 7 days)
        expiresIn:
          type: integer
          description: Access token expiration time in seconds
          example: 3600
        user:
          $ref: '#/components/schemas/User'

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User's unique identifier
        email:
          type: string
          format: email
          description: User's email address

    GuestJoinRequest:
      type: object
      required:
        - meetingId
      properties:
        meetingId:
          type: string
          format: uuid
          description: ID of the meeting to join
        inviteCode:
          type: string
          description: Optional invite code for the meeting

    GuestJoinResponse:
      type: object
      properties:
        guestSessionId:
          type: string
          format: uuid
          description: Unique ID for the guest session
        accessToken:
          type: string
          description: Temporary JWT token for guest access (expires in 24 hours)
        expiresAt:
          type: string
          format: date-time
          description: Session expiration timestamp

    ErrorResponse:
      type: object
      properties:
        statusCode:
          type: integer
          description: HTTP status code
        message:
          oneOf:
            - type: string
            - type: array
              items:
                type: string
          description: Error message(s)
        error:
          type: string
          description: Error type
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
        path:
          type: string
          description: Request path

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from login endpoints

security:
  - bearerAuth: []
